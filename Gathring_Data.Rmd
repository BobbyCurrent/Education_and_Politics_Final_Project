---
title: "Data_Stuff"
author: "Bobby Current"
date: "10/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
```

```{r}
school_spending_2017_2018 <-
spending_data_2018 <-
  read_excel("Raw_Data/Stfis180_1a.xlsx") %>%
group_by(STNAME) %>%
  select(STNAME, E11A)
  

districts_by_county <- read_excel("Raw_Data/grf19_lea_county.xlsx") %>%
  mutate(NAME_LEA19_UPPER = toupper(NAME_LEA19))

districts_by_county


spending_2012 <- read_csv("Raw_Data/district_spending_2011.csv")

plot_1 <- school_spending_2017_2018 %>%
  ggplot(aes(x = STNAME, y = E11A)) +
  geom_col() +
  labs(x = "State", 
       y = "Total Amount Paid", 
       title = "The Total Amount Paid to Teachers in 
       Regular Education Programs by State", 
       subtitle = "2017 - 2018 School Year") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


district_spending <- read_csv("Raw_Data/archive/districts.csv") 


presidential_elections <- read_csv("Raw_Data/countypres_2000-2016.csv") %>%
  mutate(vote_prop = (candidatevotes / totalvotes)) %>%
  mutate(percent_won = (vote_prop * 100)) %>%
  filter(party %in% c("democrat", "republican"))
  
  presidential_elections

spending_by_state <- read_excel("Raw_Data/tabn236.25.xls", skip = 2) %>%
  clean_names()

spending_per_student_by_state <- read_excel("Raw_Data/public-school-per-pupil-expenditures.xlsx", skip = 3) %>%
  clean_names()

  
```



```{r join}

districts_and_counties <- left_join(district_spending, districts_by_county, by = c("NAME" = "NAME_LEA19_UPPER")) %>%
  mutate(NAME_COUNTY19 = str_replace(NAME_COUNTY19, "County", ""))


left_join(districts_and_counties, presidential_elections, by = c("NAME_COUNTY19" = "county"))








```

```{r district spending}
spending_2012 <- read_csv("Raw_Data/district_spending_2011.csv") %>%
  clean_names()





```



```{r}

spending_2012 <- read_csv("Raw_Data/district_spending_2011.csv") %>%
  clean_names()


spending_2012




county_codes <- read_csv("Raw_Data/county_codes.csv") %>%
  clean_names() %>%
  select(1:2) %>%
  mutate(conum = gsub("^.", "", stcou)) %>%
  mutate(conum = as.double(conum))


district_finances_16_17 <- read_csv("Raw_Data/district_finances_16_17.csv") %>%
  clean_names()

district_codes_2016_17 <- left_join(district_finances_16_17, county_codes, by = "conum") %>%
  group_by(conum) %>%
  
  # Join before summarizing
  
 # summarize(tfedrev = sum(tfedrev), totalrev = sum(totalrev), totalexp = sum(totalexp), area_name) %>%
  separate(area_name, 
           into = c("county", "state"), 
           sep = ", ") %>%
  left_join(presidential_elections, by = c("county", "state" = "state_po"))

```

